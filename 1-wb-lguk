<?php
// ==============================
// Simple PHP File Manager (CRUD)
// ==============================

// Folder kerja (.) = folder saat ini
$dir = '.';

// Handle DELETE
if (isset($_GET['delete'])) {
    $f = basename($_GET['delete']);
    if (is_file($f)) unlink($f);
    header("Location: file_manager.php");
    exit;
}

// Handle DOWNLOAD
if (isset($_GET['download'])) {
    $f = basename($_GET['download']);
    if (is_file($f)) {
        header("Content-Disposition: attachment; filename=\"$f\"");
        header("Content-Type: application/octet-stream");
        readfile($f);
    }
    exit;
}

// Handle SAVE (EDIT FILE)
if (isset($_POST['save'])) {
    $file = basename($_POST['filename']);
    file_put_contents($file, $_POST['content']);
    header("Location: file_manager.php");
    exit;
}

// Handle UPLOAD
if (isset($_FILES['upload'])) {
    $f = basename($_FILES['upload']['name']);
    move_uploaded_file($_FILES['upload']['tmp_name'], $f);
    header("Location: file_manager.php");
    exit;
}

// Handle EDIT PAGE
if (isset($_GET['edit'])) {
    $file = basename($_GET['edit']);
    if (!is_file($file)) die("File tidak ditemukan!");
    $content = htmlspecialchars(file_get_contents($file));
    echo "<h2>Edit File: $file</h2>";
    echo "<form method='post'>
        <input type='hidden' name='filename' value='$file'>
        <textarea name='content' style='width:100%;height:400px;'>$content</textarea><br><br>
        <button type='submit' name='save'>Simpan</button>
        <a href='file_manager.php'>Batal</a>
    </form>";
    exit;
}
?>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Simple PHP File Manager</title>
</head>
<body>
<h2>Simple PHP File Manager</h2>

<form method="post" enctype="multipart/form-data">
    <input type="file" name="upload" required>
    <button type="submit">Upload</button>
</form>
<br>

<table border="1" cellpadding="5" cellspacing="0">
    <tr>
        <th>Nama File</th>
        <th>Ukuran</th>
        <th>Aksi</th>
    </tr>

<?php
$files = array_diff(scandir($dir), ['.', '..', 'file_manager.php']);
foreach ($files as $f):
    if (is_file($f)):
?>
    <tr>
        <td><?= htmlspecialchars($f) ?></td>
        <td><?= filesize($f) ?> bytes</td>
        <td>
            <a href="?download=<?= urlencode($f) ?>">Download</a> |
            <a href="?edit=<?= urlencode($f) ?>">Edit</a> |
            <a href="?delete=<?= urlencode($f) ?>" onclick="return confirm('Yakin hapus file?')">Delete</a>
        </td>
    </tr>
<?php endif; endforeach; ?>
</table>

</body>
</html>
